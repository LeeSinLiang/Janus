# Documentation for Commit af35882

**Commit Hash:** af3588259e01a2c70c5821445f3d49b62aba9813
**Commit Message:** feat(agents): add API for strategy planning and campaign management
**Generated:** Sat Nov  8 15:17:13 EST 2025
**Repository:** aiatl

---

# Janus Agents API Documentation Update

## 1. Summary

This update introduces a comprehensive RESTful API for the Janus multi-agent system, enabling external applications to interact with the strategy planning and campaign management functionalities. Key changes include new API endpoints for strategy generation and campaign listing/details, enhanced internal agent architecture for structured output, and improved testing utilities.

## 2. Changes

### 2.1. New API Endpoints

A new Django app (`agents`) has been added, exposing the following API endpoints under `http://localhost:8000/api/agents/`:

*   **`POST /strategy/`**: Generates a marketing strategy, including a Mermaid diagram, based on product description and GTM goals. It can optionally save the strategy and its constituent posts to the database.
*   **`GET /campaigns/`**: Retrieves a list of all saved marketing campaigns.
*   **`GET /campaigns/<campaign_id>/`**: Fetches detailed information for a specific campaign, including its strategy, metadata, and all associated posts.

### 2.2. Core Functionality & Data Models

*   **Strategy Planning Integration**: The `StrategyPlanningAPIView` orchestrates the `strategy_planner` agent, parses the generated Mermaid diagram into nodes and connections, and persists campaigns and posts using new Django models (`Campaign`, `Post`).
*   **Mermaid Diagram Parsing**: A new `mermaid_parser.py` utility extracts structured data (nodes, connections) from the Mermaid diagram string generated by the agent.
*   **Django Models & Serializers**: New `Campaign` and `Post` models (implicitly defined and used) are now managed via `serializers.py` for API data representation. Posts can have `next_posts` relationships, reflecting the strategy flow.
*   **CORS Configuration**: The API is configured to accept requests from `http://localhost:3000` and `http://127.0.0.1:3000`.
*   **Standardized Error Handling**: All API endpoints return consistent `success: false` responses with clear messages and HTTP status codes (400, 404, 500).

### 2.3. Agent System Enhancements

*   **Structured Output Pattern**: The `CLAUDE.md` documentation has been updated to reflect a new, preferred pattern for agents requiring structured output (e.g., `strategy_planner`, `content_creator`). This now uses `create_agent()` with `response_format=PydanticModel` and `temperature=0` for consistency, replacing the `JsonOutputParser` chain pattern.
*   **Content Creator Update**: The `ContentOutput` schema in `content_creator.py` now includes `A_image_caption` and `B_image_caption` fields, enabling agents to suggest image captions for A/B content variants. The `analyzed_report` input type for `improve_content` now expects a list of `SingleMetricsAnalysis` objects.

### 2.4. Testing & Demo Improvements

*   **`test_strategy_api.py`**: A new standalone Python script is provided to demonstrate and test the new strategy planning and campaign listing/detail API endpoints.
*   **`demo.py`**: The main demo script now includes user input for product descriptions and GTM goals, making it more interactive. All three core scenarios (Strategy Planning, A/B Content Generation, Metrics Analysis) are now fully enabled and run sequentially.

## 3. Impact

*   **External Integration**: The new API allows frontend applications (e.g., a React UI) to seamlessly trigger strategy generation and retrieve campaign data, forming the backbone of the Janus system's user interface.
*   **Robust Campaign Management**: Strategies are now persisted in a structured database, enabling long-term tracking, modification, and detailed analysis of campaigns and their individual posts.
*   **Improved Agent Reliability**: The shift to `response_format=PydanticModel` for structured output agents enhances reliability and type safety in agent interactions.
*   **Enhanced Content Generation**: The addition of image caption generation to the content creator facilitates a more complete content creation workflow.

## 4. Usage

### 4.1. API Endpoints

Refer to the newly added `backend/API_DOCS.md` for full details, request/response schemas, and cURL/Python/JavaScript examples for each endpoint.

**Example: Create Strategy**
```bash
curl -X POST http://localhost:8000/api/agents/strategy/ \
  -H "Content-Type: application/json" \
  -d '{
    "product_description": "AI-powered GTM OS for technical founders",
    "gtm_goals": "Launch and get 100 users in 4 weeks",
    "campaign_name": "Launch Campaign",
    "save_to_db": true
  }'
```

**Example: List Campaigns**
```bash
curl http://localhost:8000/api/agents/campaigns/
```

### 4.2. Testing

1.  **Run Django Server**:
    ```bash
    cd src
    python manage.py runserver
    ```
2.  **Run API Test Script**:
    ```bash
    pip install requests # if not already installed
    python test_strategy_api.py
    ```
3.  **Run Full Demo Workflow**:
    ```bash
    python demo.py
    ```

## 5. Breaking Changes

*   **Internal Agent Architecture**: For developers working directly with agents, the `JsonOutputParser` chain pattern has been superseded by `create_agent(..., response_format=PydanticModel)`. This is an internal change and does not affect the public API.
*   **Content Creator `improve_content`**: The `analyzed_report` parameter now expects a list of `SingleMetricsAnalysis` objects, not a raw string.

## 6. Migration Notes

*   **Existing Agent Implementations**: If you have custom agents that previously used `JsonOutputParser`, consider refactoring them to use the `response_format=PydanticModel` pattern for improved robustness, as detailed in `backend/CLAUDE.md`.
*   **Database Migrations**: Ensure you run Django migrations to create the new `Campaign` and `Post` tables:
    ```bash
    cd src
    python manage.py makemigrations agents
    python manage.py migrate
    ```