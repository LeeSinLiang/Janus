version: '3.8'

services:
  janus:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Pass build-time env vars to Next.js build
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:8000}
    container_name: janus-app
    ports:
      - "80:3000"  # Frontend
      - "8000:8000"  # Backend
    volumes:
      # Persist database (mount parent dir to avoid file vs directory issue)
      - ./backend/src:/app/backend/src
      # Persist media files
      - ./backend/generated_videos:/app/backend/generated_videos
      # Mount .env file
      - ./.env:/app/backend/.env
      - ./.env:/app/frontend/.env.local
    environment:
      - PYTHONUNBUFFERED=1
      - DEBUG=True
    restart: unless-stopped
    stdin_open: true
    tty: true

# Optional: Add PostgreSQL for production
#  db:
#    image: postgres:15-alpine
#    container_name: janus-db
#    environment:
#      POSTGRES_DB: janus_db
#      POSTGRES_USER: janus_user
#      POSTGRES_PASSWORD: janus_password
#    volumes:
#      - postgres_data:/var/lib/postgresql/data
#    ports:
#      - "5432:5432"
#    restart: unless-stopped

#volumes:
#  postgres_data:
